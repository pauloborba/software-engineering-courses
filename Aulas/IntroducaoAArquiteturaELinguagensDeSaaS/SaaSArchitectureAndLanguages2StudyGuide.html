<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>SaaSArchitectureAndLanguages2</title>
  <style>
    html {
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    svg {
      height: auto;
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
</head>
<body>
<h1
id="roteiro-de-exercícios-sobre-saas-parte-de-serviços-disciplina-engenharia-de-software-e-sistemas">Roteiro
de exercícios sobre SaaS, parte de serviços, disciplina Engenharia de
Software e Sistemas</h1>
<h2 id="paulo-borba">Paulo Borba</h2>
<h2 id="centro-de-informática">Centro de Informática</h2>
<h2 id="universidade-federal-de-pernambuco">Universidade Federal de
Pernambuco</h2>
<p>Adicione as respostas imediatamente após as perguntas, usando uma
outra cor. Leia com calma e atenção as instruções, e reflita com cautela
sobre as consequências de cada comando. <strong>As instruções abaixo
assumem que toda a parte de instalação do roteiro de SaaS-GUI foi
concluída.</strong> É também assumido que todas as referência (manuais,
tutoriais, etc.) mencionadas no roteiro anterior já foram consultadas, e
que os alunos devem estar prontos para rapidamente consultá-las
novamente durante o resto do curso, inclusive quando seguindo o roteiro
abaixo. Os <em>commits</em> mencionados abaixo não são referentes ao que
está no <em>master</em> do repositório do projeto; eles são referentes
ao que está no <strong><em>branch</em> criado pelo professor e associado
à essa edição da disciplina (por exemplo, 2019-2, 2020-1,
etc.)</strong></p>
<h2 id="aula-4">Aula 4</h2>
<ol type="1">
<li><p>No projeto <a
href="https://github.com/pauloborba/teachingassistant/commits/master"><strong><u>teachingassistant</u></strong></a>,
analise o <em>commit</em> "<a
href="https://github.com/pauloborba/teachingassistant/commit/bd62070b3f1c37496b6f66a856fde9b1393b5697">versao
toy do servidor</a>". Um dos arquivos no <em>commit</em>, o
<strong>package.json</strong>, é responsável pela configuração do
projeto do servidor. Qual o efeito das declarações que envolvem
<strong>"devDependencies" e "dependencies"</strong> nesse arquivo? O
arquivo <strong>tsconfig.json</strong> é responsável pela configuração
do compilador Typescript. Qual o efeito da declaração
<strong>"outDir":"compiledCode"</strong> neste segundo arquivo?</p></li>
<li><p>O arquivo <strong>ta-server.ts</strong> é um servidor <a
href="http://expressjs.com/en/starter/installing.html"><u>Express</u></a>
simples, escrito em Typescript. Aplique as mudanças desse
<em>commit</em> no seu <em>branch</em> (idealmente com
<em>cherry-pick</em>). Instale as dependências necessárias digitando
<strong>npm install</strong> no diretório <strong>ta-server</strong>. Em
seguida, coloque o servidor no ar digitando <strong>npm start</strong>.
Qual o efeito da declaração <strong>"start":"npm run tsc &amp;&amp; node
compiledCode/ta-server.js"</strong> no arquivo
<strong>package.json</strong>? Em algumas máquinas pode aparecer o erro
<strong>"UNMET PEER DEPENDENCY xxxxx"</strong> quando executando
<strong>npm install</strong>. Nesse caso, dê <strong>npm install
xxxxx</strong> para cada um dos "xxxxx" que aparecerem e, em seguida, dê
<strong>npm install</strong>. Se encontrar problemas de permissão quando
tentando instalar algo do node, consulte o <a
href="https://docs.npmjs.com/getting-started/fixing-npm-permissions"><u>manual</u></a>
do node. No Windows, o tsc é instalado no diretório node_modules/.bin.
Você precisa adicionar o caminho desse diretório ao seu PATH. Se
necessário, use <strong>^C</strong> para matar um processo que esteja
executando em um terminal.</p></li>
<li><p>Teste o servidor digitando no sew <em>browser</em></p></li>
</ol>
<blockquote>
<p><strong>http://localhost:3000/</strong></p>
<p>Qual o comportamento observado no <em>browser</em>? Cole a imagem
logo a seguir. Que requisições/serviços (explicitar método HTTP, URL,
parâmetros, retorno esperado) esse servidor está apto a receber? O que
representa o parâmetro <strong>res</strong> no código do servidor? O que
representa o parâmetro <strong>req</strong> no código do servidor?
Consulte o manual de referência de <a
href="http://expressjs.com"><u>Express</u></a> e <a
href="https://nodejs.org/en/"><u>Node.js</u></a>.</p>
</blockquote>
<ol start="4" type="1">
<li><p>Verifique como depurar o código do servidor com uma ferramenta de
depuração (como a <a
href="https://code.visualstudio.com/docs/nodejs/nodejs-debugging"><u>provida</u></a>
pelo VSCode, por exemplo) ou, em última hipótese, com
<strong><mark>console.log().</mark></strong></p></li>
<li><p>Analise o <em>commit</em> "versao inicial do servidor, apos
extracao de aluno para area comum". Observe que a classe
<strong>Aluno</strong> foi movida de <a
href="https://github.com/pauloborba/teachingassistant/commits/2019-2#diff-0f57754a05119ef068edaa10de6bec8e"><strong>ta-gui/src/app/aluno.ts</strong></a>
para <a
href="https://github.com/pauloborba/teachingassistant/commits/2019-2#diff-65f657d20934dfb9ec374ab261888805"><strong>common/aluno.ts</strong></a>
já que ela vai ser usada pelo servidor também. Assim, veremos que os
projetos <strong>ta-gui</strong> e <strong>ta-server</strong> dependem
do projeto <strong>common</strong> (os arquivos de configuração do mesmo
fazem parte do <em>commit</em>). Sem a mudança de diretório,
<strong>ta-server</strong> teria que depender de <strong>ta-gui</strong>
para usar a classe <strong>Aluno</strong>. Por que isso poderia não ser
uma boa opção de <em>design</em>? Além da mudança de diretório, o método
<strong>clone</strong> foi modificado. Você acha que essas modificações
alteraram o comportamento dos objetos dessa classe (no sentido de que o
método <strong>clone</strong> retornava um aluno com características
diferentes da que ele agora retorna)? Por que?</p></li>
<li><p>Observe a semelhança da classe <strong>CadastroDeAlunos</strong>
do servidor com a classe <a
href="https://github.com/pauloborba/teachingassistant/blob/41c886377d61e2db7b89f57ae01edf101146988b/gui/ta-gui/src/app/aluno.service.ts"><strong><u>AlunoService</u></strong></a>
da GUI. Esquecendo os detalhes de importação e anotação antes das
declarações das classes, quais as principais diferenças entre elas? O
que justifica essas diferenças? As duas não permanecerão na versão final
do sistema. Essa duplicação ocorre apenas porque essa funcionalidade de
armazenamento de alunos, que pertence naturalmente ao servidor, estava
sendo temporariamente simulada na GUI, para que a gente pudesse testar a
GUI de forma isolada do servidor.</p></li>
<li><p>Observe o arquivo <a
href="https://github.com/pauloborba/teachingassistant/commits/5c594afd0337f11e2329c554151c950767e35e10#diff-e8e3855437d5cb12c83fad60c8473eb7"><strong>ta-server.ts</strong></a>,
que implementa o servidor. Essa é uma versão mais elaborada do servidor.
Que requisições/serviços (explicitar método HTTP, URL, parâmetros,
retorno esperado) esse servidor está apto a receber? O que justifica a
diferença entre os métodos escolhidos? Observe que o pacote <a
href="https://www.npmjs.com/package/body-parser"><u>body-parser</u></a>
foi adicionado como dependência do projeto <strong>ta-server</strong> e
é utilizado pelo novo código do servidor; consulte a sua documentação.
Que funcionalidade é oferecida por esse pacote e utilizada pelo
servidor?</p></li>
<li><p>Note que esse servidor repassa a execução dos serviços para o
cadastro de alunos, e fica responsável apenas por extrair informações
das requisições, e preparar as respostas no formato adequado. Seria
melhor uma solução que não empregasse essa separação entre as
preocupações de realizar o serviço (classe
<strong>CadastroDeAlunos</strong>), e a de processar requisições e
respostas (<a
href="https://github.com/pauloborba/teachingassistant/commits/5c594afd0337f11e2329c554151c950767e35e10#diff-e8e3855437d5cb12c83fad60c8473eb7"><strong>ta-server.ts</strong></a>)?
Por que?</p></li>
<li><p>Aplique as mudanças desse <em>commit</em> no seu <em>branch</em>
(idealmente com <em>cherry-pick</em>). Instale as dependências
necessárias digitando <strong>npm install</strong> nos diretórios
<strong>ta-server</strong> e <strong>common</strong>. Em seguida,
coloque o servidor no ar digitando <strong>npm start</strong>. <mark>Se
você estiver usando o Windows, tem que ajustar (no arquivo
<strong>package.json</strong>) o caminho do <strong>tsc</strong>; ele
tenta chamar <strong>./node_modules/.</strong>, mas, no Windows, tem que
descobrir o endereço onde o <strong>tsc</strong> está instalado e
ajustar no <strong>package.json</strong> (invertendo as barras do PATH,
já que essa é uma diferença importante do unix para o Windows).</mark>
Teste o servidor. As requisições GET podem ser testadas pelo browser,
como antes. As requisições POST e PUT podem ser testadas via linha de
comandos da seguinte forma:</p></li>
</ol>
<blockquote>
<p><strong>curl -i -X POST -H 'Content-Type: application/json' -d
'{"nome": "Mariana", "cpf":"683", "email":"mcb@cin", "metas":{}}'
localhost:3000/aluno/</strong></p>
<p><strong>curl -i -X PUT -H 'Content-Type: application/json' -d
'{"nome": "Pedro", "cpf":"684", "email":"pcb@ufpe",
"metas":{"requisitos":"MA"}}' localhost:3000/aluno/</strong></p>
<p>Cadastre e modifique alguns alunos com esses comandos (cuidado com o
copy-and-paste direto daqui para o terminal, o que pode introduzir
caracteres e quebras de linhas indesejadas; se for o caso, copie antes
para um editor na sua máquina, elimine as quebras, etc.). Verifique via
<em>browser</em> se as operações estão sendo corretamente executadas.
Cole logo a seguir a imagem do seu <em>browser</em> após a solicitação
do serviço GET <strong>/alunos</strong>. Se você estiver usando o
Windows (sem cygwin ou WSL, o que certamente atrapalha o andamento do
curso), é provável que você tenha que instalar o comando
<strong>curl</strong> ou usar um outro software (veja o API Client do <a
href="https://www.postman.com"><u>Postman</u></a>, do <a
href="https://insomnia.rest"><u>Insomnia</u></a> ou similares) que
permita esse tipo de teste através do envio de requisições.</p>
</blockquote>
<h2 id="aula-5">Aula 5</h2>
<ol start="10" type="1">
<li><p>Analise agora o commit "servidor integrado ao cliente". Note que
as modificações no código do servidor foram apenas para melhorar a
legibilidade, e permitir que a gente teste a parte de GUI e a parte de
cliente tanto de forma isolada quanto integrada. Aplique as mudanças
desse <em>commit</em> no seu <em>branch</em> (idealmente com
<em>cherry-pick</em>). Coloque o cliente (em um terminal, com
<strong>npm start</strong> no diretório do cliente) e o servidor (em
outro terminal ou aba, com <strong>npm start</strong> no diretório do
servidor) em execução. Teste o sistema via GUI integrada ao servidor,
cadastrando alguns alunos e avaliações de metas. Cole logo a seguir as
imagens do seu <em>browser</em> mostrando uma das telas da GUI (a de
metas, por exemplo) e o retorno dado pelo servidor à requisição <a
href="http://localhost:3000/alunos"><strong><u>http://localhost:3000/alunos</u></strong></a>
feita direto no browser<em>.</em></p></li>
<li><p>As principais modificações necessárias para a integração entre
cliente e servidor estão na parte de GUI, na classe
<strong>AlunoService</strong>, que agora de fato chama os serviços do
servidor, ao invés de simulá-los. Que parte dessa classe
<strong>AlunoService</strong> indica que ela realmente acessará o
servidor que discutimos antes?</p></li>
<li><p>Consulte a referência do pacote <a
href="http://reactivex.io/rxjs/"><u>RxJS</u></a> e o <a
href="https://angular.io/guide/observables"><u>tutorial</u></a> de
Angular sobre o assunto. Estude principalmente o conceito
<strong>Observable</strong> (observável), que representa uma potencial
lista (ou <em>stream</em>) de elementos de um determinado tipo e que
podem ser observados e consumidos por quem tiver interesse. Dizemos que
representa uma potencial lista porque, de fato, não há garantia de que
tal lista venha a existir. Essa indefinição serve para representar, por
exemplo, situações como quando um cliente tenta enviar uma requisição a
um servidor. Nesses casos, diversos problemas podem ocorrer: o cliente
pode estar temporariamente sem acesso à rede, o servidor pode estar fora
do ar, etc. Por isso a tentativa de envio da requisição não garante que
haverá uma resposta do servidor. O tipo de retorno dessa operação de
tentativa de envio deve então ser um <strong>Observable</strong>,
indicando que tanto pode haver uma resposta (no caso de requisições HTTP
a lista teria apenas um elemento) quanto pode não haver resposta
nenhuma, apenas uma sinalização de erro. Mesmo quando houver uma
resposta, não há garantias de que ela estará disponível logo após a
criação do objeto <strong>Observable</strong>. Isso é o que permite, por
exemplo, que a tentativa de envio de uma requisição a um servidor seja
implementada de forma assíncrona. Isto é, o cliente rapidamente envia a
requisição, recebe um objeto <strong>Observable</strong>, não fica
esperando uma resposta do servidor (que pode demorar, ou nem chegar), e
segue executando outras operações, evitando o bloqueio da GUI (por
exemplo, o usuário pode digitar os conceitos do segundo aluno mesmo que
a GUI ainda não tenha recebido a confirmação de que os conceitos do
primeiro foram gravados no servidor). Por que o método
<strong>getAlunos</strong> da classe <strong>AlunoService</strong> agora
retorna <strong>Observable&lt;Aluno[]&gt;</strong> ao invés de
<strong>Aluno[]</strong> (como era o caso na implementação anterior, que
acessava um <em>array</em> local ao cliente e retornava seu conteúdo em
um novo <em>array</em>)? Qual seria o efeito de tirar o
<strong>.pipe(retry(2))</strong> do código de
<strong>getAlunos</strong>?</p></li>
<li><p>Em relação ao método <strong>get</strong> chamado em
<strong>getAlunos</strong>, quais os parâmetros adicionais recebidos
pelos métodos <strong>put</strong> e <strong>post</strong> chamados,
respectivamente, nos métodos <strong>atualizar</strong> e
<strong>criar</strong>? Por que eles são necessários nesses dois casos e
não no caso do <strong>get</strong>? Como esses métodos foram chamados
com o tipo <strong>any</strong>, o que podemos assumir sobre os
elementos dos objetos <strong>Observable&lt;any&gt;</strong> a serem
retornados por eles? Para transformar
<strong>Observable&lt;any&gt;</strong> em
<strong>Observable&lt;Aluno&gt;</strong>, e assim ter acesso a mais
informações nos componentes da GUI quando as requisições forem
adequadamente respondidas, usamos a função <strong>map</strong>. O que
faz a função recebida como argumento por <strong>map</strong> nos
métodos <strong>atualizar</strong> e <strong>criar</strong>? O que
verifica a condição <strong>res.success</strong> feita nessas funções?
Por que a verificação é feita usado <strong>success</strong> e não um
outro atributo?</p></li>
<li><p>Com essa organização, a classe de serviço é responsável por
preparar as requisições dos serviços do servidor (feitas pelas chamadas
aos métodos de <strong>HttpClient</strong>), cuidar do reenvio caso
necessário (<strong>retry</strong>), e definir como eventuais respostas
a essas requisições serão processadas (<strong>map</strong>). Mas a
observação e consumo das respostas, ou de notificações de erro, são
feitos nos componentes da GUI. Por que você acha que optamos por essa
organização? Pense em que tipo de mensagem de erro você poder emitir em
um componente e não pode emitir em uma classe de serviço.</p></li>
<li><p>Na classe <strong>AlunosComponent</strong>, observe o método
<strong>ngOnInit</strong>. O método <strong>getAlunos</strong> invocado
antes dava garantia de retorno de um <em>array</em> de alunos. Agora
temos apenas a garantia de que será retornando
<strong>Observable&lt;Aluno[]&gt;</strong>, o que não nos garante muita
coisa. Para observar e consumir os elementos de um
<strong>Observable</strong> ou eventuais notificações de erro, usamos o
método <strong>subscribe</strong>. Nesse caso, quantos argumentos ele
recebe? Quais os tipos desses argumentos? O primeiro é utilizado para
cada <em>array</em> que possa eventualmente ser observado. Qual o efeito
esperado? O segundo é utilizado para cada notificação de erro. Qual o
efeito esperado?</p></li>
<li><p>Na classe <strong>AlunosComponent</strong>, qual o propósito do
<strong>condicional</strong> (<strong>if</strong>) utilizado no método
<strong>criarAluno</strong> desse componente? Por que ele é necessário?
Adicione o comando <strong>alert("Já executei o criar e o
subscribe!");</strong> na última linha do método
<strong>criarAluno.</strong> Recarregue (<em>reload</em>) a GUI do
sistema e crie um novo aluno. O sistema mostra primeiro o alerta com a
mensagem ou o novo aluno na lista de alunos? O que isso indica em termos
de comunicação assíncrona e concorrência?</p></li>
<li><p>Na classe <strong>MetasComponent</strong>, qual o propósito do
<strong>condicional</strong> (<strong>if</strong>) utilizado no método
<strong>atualizarAluno</strong> desse componente? Por que ele é
necessário?</p></li>
<li><p>Altere o sistema para que seja possível armazenar também
conceitos para as metas "Gerência de Projetos" e "Testes". Compile,
execute o cliente e servidor, e teste manualmente a nova funcionalidade.
Cole logo abaixo a imagem do seu <em>browser</em> dando evidência do
correto funcionamento da nova funcionalidade.</p></li>
</ol>
<h2 id="aula-6">Aula 6</h2>
<ol start="19" type="1">
<li><p>Altere o sistema para que ele considere também o login GitHub de
cada aluno cadastrado, considerando que esse login também não pode ser
duplicado, assim como o CPF. Compile, execute o cliente e servidor, e
teste manualmente a nova funcionalidade. Cole logo abaixo a imagem do
seu <em>browser</em> dando evidência do correto funcionamento da nova
funcionalidade.</p></li>
<li><p>Altere o sistema para que seja possível remover um aluno
cadastrado (adicione um botão de remoção ao lado de cada aluno listado
no componente <strong>Alunos</strong>, ou adicione um botão de remoção
ao lado do botão <strong>Adicionar</strong>). Veja no <a
href="https://angular.io/guide/http#making-a-delete-request"><u>tutorial</u></a>
de Angular como solicitar o envio de requisições
<strong>DELETE</strong>. Note que para aceitar parâmetros como parte da
URL de solicitação de uma requisição ao servidor, temos que registrá-la
da seguinte forma no servidor, no caso em que cpf é o nome do parâmetro
a ser passado: '/aluno/:cpf'. No código associado a esse serviço,
req.params.cpf pode ser usado para obter o valor passado na requisição,
assumindo que req representa a requisição sendo tratada (todo objeto que
representa uma requisição tem um atributo params, que é um objeto que
mapeia nomes de parâmetros nos seus valores associados). Compile,
execute o cliente e servidor, e teste manualmente a nova funcionalidade.
Cole logo abaixo a imagem do seu <em>browser</em> dando evidência do
correto funcionamento da nova funcionalidade.</p></li>
</ol>
</body>
</html>
